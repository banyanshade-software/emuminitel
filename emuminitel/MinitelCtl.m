//
//  MinitelCtl.m
//  emuminitel
//
//  Created by Daniel Braun on 08/03/2024.
//

#import "MinitelCtl.h"

uint32_t SimuTick = 0;

@implementation MinitelCtl {
    WKUserContentController *wkuserctrl;
}

- (void) awakeFromNib
{
    [super awakeFromNib];
    [self loadHtml];
}
- (void) loadHtml
{
    NSURL *u = [[NSBundle mainBundle] URLForResource:@"index" withExtension:@"html" subdirectory:@"web"];
    NSURL *u0 = [u URLByDeletingLastPathComponent];
    NSAssert(u, @"index.html missing");
    NSError *err;
    NSString *mntlhtml = [NSString stringWithContentsOfURL:u encoding:NSUTF8StringEncoding error:&err];
    WKNavigation *nv = [_m1 loadHTMLString:mntlhtml baseURL:u0];
    NSAssert(nv, @"load failed");
    
    
    wkuserctrl = _m1.configuration.userContentController;
    [wkuserctrl addScriptMessageHandler:self name:@"kbd"];
    [wkuserctrl addScriptMessageHandler:self name:@"ctrlflow"];
}

- (void) installJavascript
{
    NSString *js;

    // keyboard from minitel
    js = @"function minitelFromStr(s) { window.webkit.messageHandlers.kbd.postMessage(s) }";
    [_m1 evaluateJavaScript:js completionHandler:^(id v, NSError *err) {
        if (err) {
            NSLog(@"js error : %@\n", err);
        }
    }];
    js = @"function minitelFromDone() { window.webkit.messageHandlers.ctrlflow.postMessage('') }";
    [_m1 evaluateJavaScript:js completionHandler:^(id v, NSError *err) {
        if (err) {
            NSLog(@"js error : %@\n", err);
        }
    }];
}

- (void) sendStringToMinitel:(NSString *)s
{
    s = [s stringByReplacingOccurrencesOfString:@"'" withString:@"\\'"];
    NSString *js = [NSString stringWithFormat:@"minitelSendString('%@');", s];
    [_m1 evaluateJavaScript:js completionHandler:^(id v, NSError *err) {
        if (err) {
            NSLog(@"js error : %@\n", err);
        }
    }];

}
- (void) sendBytesToMinitel:(const uint8_t *)bytes length:(int)len
{
    NSMutableString *s = [[NSMutableString alloc]initWithString:@"minitelSendBytes(["];
    for (int i=0; i<len; i++) {
        [s appendFormat:@"0x%2.2X%s", bytes[i], (i<len-1) ? ", " : "]);"];
    }
    [_m1 evaluateJavaScript:s completionHandler:^(id v, NSError *err) {
        if (err) {
            NSLog(@"js error : %@\n", err);
        }
    }];

}
- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation
{
    [self installJavascript];
    if ((0)) [self performSelector:@selector(sendExample) withObject:nil afterDelay:1];
    [self performSelector:@selector(refreshScreen) withObject:nil afterDelay:1];
}

- (void) refreshScreen
{
    NSView *v = _m1.superview;
    [_m1 setNeedsLayout:YES];
    [_m1 setNeedsDisplay:YES];
    
    [v setNeedsLayout:YES];
    [v setNeedsDisplay:YES];
}

- (void)userContentController:(nonnull WKUserContentController *)userContentController didReceiveScriptMessage:(nonnull WKScriptMessage *)message
{
    NSString *s = message.body;
    NSString *t = message.name;
    
    NSLog(@"rx %@ len %d : %@", t, (int) s.length, s);
}

- (void) sendExample
{
    NSString *s=@"hopla on se reveille car \"longtemps\" 'je me suis leve de bonne heure' comme disait l'autre";
    [self sendStringToMinitel:s];
}


- (IBAction) test1:(id)sender
{
    // od -t x1 ~/Downloads/undefined.vdt | sed 's/^[0-9]* //g' | sed 's/   /  /g'  | sed 's/  /, 0x/g'  > /tmp/t
    static const uint8_t str[]={
  0x0c, 0x1f, 0x40, 0x41, 0x18, 0x0a, 0x0f, 0x47, 0x6f, 0x6f, 0x64, 0x20, 0x6d, 0x6f, 0x72, 0x6e
, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x39, 0x38, 0x30, 0x73, 0x1f, 0x42, 0x51, 0x0e, 0x1b, 0x42, 0x50
, 0x12, 0x49, 0x1f, 0x43, 0x51, 0x0e, 0x1b, 0x52, 0x20, 0x12, 0x49, 0x1f, 0x44, 0x45, 0x0e, 0x1b
, 0x41, 0x40, 0x50, 0x12, 0x44, 0x30, 0x09, 0x09, 0x09, 0x09, 0x09, 0x1b, 0x52, 0x20, 0x20, 0x20
, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1f, 0x45, 0x45, 0x0e, 0x1b, 0x41, 0x4a, 0x1b, 0x51
, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40, 0x4a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x1b, 0x52, 0x20
, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1f, 0x46, 0x45, 0x0e, 0x1b, 0x41, 0x4a
, 0x1b, 0x51, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40, 0x4a, 0x09, 0x09, 0x1b, 0x56, 0x20, 0x20
, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x4a, 0x1f, 0x47, 0x45, 0x0e, 0x1b, 0x41, 0x4a, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x42, 0x40, 0x50
, 0x50, 0x1b, 0x40, 0x5a, 0x1b, 0x50, 0x1b, 0x42, 0x50, 0x50, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40
, 0x4a, 0x1f, 0x48, 0x45, 0x0e, 0x1b, 0x41, 0x4a, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x42, 0x4a, 0x1b
, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x1b, 0x50, 0x1b, 0x46, 0x50, 0x1b, 0x52, 0x50, 0x30, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40
, 0x4a, 0x1f, 0x49, 0x45, 0x0e, 0x1b, 0x41, 0x4a, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x42, 0x4a, 0x1b
, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x20, 0x4a, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40, 0x4a, 0x1f, 0x4a, 0x45
, 0x0e, 0x1b, 0x41, 0x2a, 0x1b, 0x51, 0x1b, 0x40, 0x50, 0x50, 0x1b, 0x52, 0x1b, 0x41, 0x35, 0x20
, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x56, 0x1b, 0x42, 0x50, 0x50, 0x1b, 0x41, 0x12, 0x42, 0x30, 0x20
, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40, 0x4a, 0x1b, 0x50, 0x1b, 0x42, 0x23, 0x23, 0x1b, 0x52, 0x1b
, 0x40, 0x5c, 0x1b, 0x50, 0x1b, 0x42, 0x23, 0x23, 0x21, 0x1f, 0x4b, 0x48, 0x0e, 0x1b, 0x42, 0x4a
, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x46, 0x4a
, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x40, 0x4a, 0x09, 0x1b, 0x50, 0x1b, 0x47, 0x40
, 0x26, 0x1f, 0x4c, 0x48, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x46, 0x4a, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b
, 0x40, 0x4a, 0x1b, 0x50, 0x1b, 0x47, 0x40, 0x26, 0x1f, 0x4d, 0x48, 0x0e, 0x1b, 0x42, 0x2a, 0x1b
, 0x52, 0x1b, 0x40, 0x50, 0x12, 0x43, 0x1b, 0x41, 0x12, 0x43, 0x1b, 0x51, 0x20, 0x1b, 0x42, 0x48
, 0x1b, 0x56, 0x35, 0x20, 0x20, 0x20, 0x20, 0x20, 0x4a, 0x1b, 0x52, 0x1b, 0x40, 0x23, 0x1f, 0x4e
, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x1b, 0x46, 0x4a, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x20, 0x1f, 0x4f, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52
, 0x1b, 0x46, 0x4a, 0x1b, 0x56, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x20
, 0x1f, 0x50, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x1b, 0x46, 0x2a, 0x1b, 0x56, 0x1b, 0x42
, 0x50, 0x12, 0x44, 0x1b, 0x52, 0x1b, 0x46, 0x25, 0x20, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x40, 0x4a
, 0x1f, 0x51, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x40, 0x4a, 0x1f, 0x52, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b
, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x1b, 0x51, 0x20, 0x20, 0x1b, 0x40, 0x4a
, 0x1f, 0x53, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x1f, 0x54, 0x51, 0x0e, 0x1b, 0x42, 0x4a, 0x1b, 0x52, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
, 0x20, 0x20, 0x1f, 0x55, 0x51, 0x0e, 0x1b, 0x42, 0x22, 0x23, 0x12, 0x47, 0x1f, 0x46, 0x52, 0x0e
, 0x1b, 0x53, 0x20, 0x12, 0x48, 0x1f, 0x47, 0x52, 0x0e, 0x1b, 0x53, 0x20, 0x12, 0x48, 0x0f, 0x1f
, 0x4c, 0x42, 0x1b, 0x4f, 0x63, 0x27, 0x19, 0x42, 0x65, 0x74, 0x61, 0x69, 0x74, 0x20, 0x6d, 0x69
, 0x65, 0x75, 0x78, 0x20, 0x61, 0x76, 0x61, 0x6e, 0x74, 0x0d, 0x0a, 0x00};
    
    [self sendBytesToMinitel:str length:sizeof(str)];
}
- (IBAction) test2:(id)sender
{
    // cat ... | od -v -t x1  | sed 's/^[0-9]* //g' | sed 's/   /  /g'  | sed 's/  /, 0x/g'  > /tmp/t
    static const uint8_t str[]={
  0x1f, 0x40, 0x41, 0x18, 0x0c, 0x1f, 0x41, 0x41, 0x1b, 0x28, 0x20, 0x42, 0x7f, 0x12, 0x44, 0x21
, 0x22, 0x23, 0x20, 0x12, 0x44, 0x24, 0x25, 0x26, 0x7f, 0x12, 0x43, 0x1f, 0x42, 0x41, 0x7f, 0x12
, 0x43, 0x27, 0x20, 0x12, 0x4a, 0x28, 0x29, 0x7f, 0x7f, 0x1f, 0x43, 0x41, 0x7f, 0x7f, 0x2a, 0x2b
, 0x20, 0x12, 0x4c, 0x2c, 0x2d, 0x7f, 0x1f, 0x44, 0x41, 0x7f, 0x2e, 0x20, 0x12, 0x4f, 0x2f, 0x7f
, 0x1f, 0x45, 0x41, 0x7f, 0x30, 0x20, 0x12, 0x50, 0x31, 0x1f, 0x46, 0x41, 0x32, 0x20, 0x12, 0x51
, 0x33, 0x1f, 0x47, 0x41, 0x34, 0x20, 0x12, 0x51, 0x35, 0x1f, 0x48, 0x41, 0x36, 0x20, 0x12, 0x46
, 0x37, 0x38, 0x20, 0x20, 0x38, 0x20, 0x12, 0x45, 0x39, 0x1f, 0x49, 0x41, 0x3a, 0x20, 0x12, 0x45
, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f, 0x40, 0x1b, 0x5d, 0x2a, 0x1b, 0x5c, 0x41, 0x20, 0x12, 0x43, 0x42
, 0x1f, 0x4a, 0x41, 0x7f, 0x43, 0x20, 0x12, 0x43, 0x44, 0x45, 0x46, 0x47, 0x7f, 0x48, 0x20, 0x49
, 0x20, 0x12, 0x44, 0x7f, 0x1f, 0x4b, 0x41, 0x7f, 0x7f, 0x1b, 0x5d, 0x2d, 0x1b, 0x5c, 0x20, 0x12
, 0x44, 0x4a, 0x4b, 0x7f, 0x4c, 0x4d, 0x4e, 0x4f, 0x50, 0x51, 0x20, 0x52, 0x7f, 0x1f, 0x4c, 0x41
, 0x7f, 0x7f, 0x1b, 0x5d, 0x2c, 0x2d, 0x1b, 0x5c, 0x20, 0x53, 0x54, 0x55, 0x7f, 0x12, 0x47, 0x56
, 0x20, 0x1b, 0x5d, 0x34, 0x1b, 0x5c, 0x7f, 0x1f, 0x4d, 0x41, 0x7f, 0x7f, 0x7f, 0x1b, 0x5d, 0x2c
, 0x1b, 0x5c, 0x57, 0x58, 0x7f, 0x12, 0x44, 0x59, 0x5a, 0x7f, 0x7f, 0x7f, 0x30, 0x5b, 0x7f, 0x7f
, 0x1f, 0x4e, 0x41, 0x7f, 0x12, 0x43, 0x5c, 0x5d, 0x5e, 0x7f, 0x7f, 0x5f, 0x60, 0x61, 0x62, 0x7f
, 0x7f, 0x63, 0x20, 0x7f, 0x7f, 0x7f, 0x1f, 0x4f, 0x41, 0x7f, 0x12, 0x45, 0x64, 0x65, 0x7f, 0x7f
, 0x66, 0x67, 0x68, 0x69, 0x6a, 0x20, 0x35, 0x7f, 0x7f, 0x7f, 0x1f, 0x50, 0x41, 0x7f, 0x12, 0x45
, 0x6b, 0x6c, 0x6d, 0x1b, 0x5d, 0x50, 0x1b, 0x5c, 0x6e, 0x6f, 0x70, 0x20, 0x20, 0x20, 0x71, 0x7f
, 0x7f, 0x7f, 0x1f, 0x51, 0x41, 0x7f, 0x12, 0x46, 0x72, 0x20, 0x20, 0x73, 0x22, 0x2b, 0x20, 0x20
, 0x20, 0x74, 0x7f, 0x7f, 0x7f, 0x1f, 0x52, 0x41, 0x7f, 0x12, 0x46, 0x75, 0x76, 0x20, 0x77, 0x78
, 0x79, 0x7a, 0x20, 0x20, 0x1b, 0x5d, 0x3a, 0x1b, 0x5c, 0x7f, 0x7f, 0x7f, 0x1f, 0x53, 0x41, 0x7f
, 0x12, 0x46, 0x1b, 0x5d, 0x35, 0x1b, 0x5c, 0x20, 0x12, 0x48, 0x2d, 0x7f, 0x7f, 0x1f, 0x54, 0x41
, 0x7f, 0x12, 0x46, 0x1b, 0x5d, 0x35, 0x1b, 0x5c, 0x7b, 0x7c, 0x20, 0x12, 0x44, 0x7d, 0x7e, 0x2c
, 0x1b, 0x29, 0x20, 0x43, 0x0e, 0x21, 0x0f, 0x29, 0x1f, 0x55, 0x41, 0x7f, 0x12, 0x46, 0x0e, 0x22
, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x1f, 0x56, 0x41, 0x7f
, 0x12, 0x44, 0x21, 0x0e, 0x2f, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x7f, 0x36, 0x7f, 0x12, 0x44
, 0x1f, 0x57, 0x41, 0x7f, 0x21, 0x0e, 0x37, 0x38, 0x0f, 0x23, 0x20, 0x0e, 0x39, 0x3a, 0x7f, 0x12
, 0x45, 0x3b, 0x3c, 0x7f, 0x12, 0x43, 0x1f, 0x58, 0x41, 0x7f, 0x0e, 0x3d, 0x20, 0x12, 0x43, 0x3e
, 0x3f, 0x40, 0x41, 0x7f, 0x7f, 0x7f, 0x42, 0x43, 0x44, 0x7f, 0x12, 0x43, 0x1b, 0x28, 0x40, 0x1b
, 0x29, 0x63, 0x1f, 0x23, 0x20, 0x20, 0x20, 0x42, 0x49, 0x1f, 0x23, 0x21, 0x30, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x43, 0x70, 0x78, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7b, 0x60, 0x30, 0x7f, 0x6f, 0x63, 0x60, 0x68, 0x30, 0x5f, 0x70, 0x6c, 0x30, 0x7f, 0x7f
, 0x7f, 0x7f, 0x47, 0x70, 0x5c, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7d, 0x7f, 0x4f, 0x70
, 0x5c, 0x43, 0x30, 0x7f, 0x7f, 0x7f, 0x7e, 0x7a, 0x4e, 0x62, 0x40, 0x60, 0x30, 0x5f, 0x71, 0x7c
, 0x4f, 0x40, 0x70, 0x4c, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x7c
, 0x7f, 0x47, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7e, 0x7e, 0x4f, 0x43, 0x60
, 0x70, 0x30, 0x7e, 0x4e, 0x43, 0x60, 0x60, 0x30, 0x43, 0x70, 0x5c, 0x43, 0x40, 0x50, 0x30, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7f, 0x77, 0x7d, 0x7f, 0x4f, 0x71, 0x7c, 0x5f, 0x43, 0x70, 0x30, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x6f, 0x73, 0x7c, 0x7e, 0x4f, 0x43, 0x70, 0x78, 0x30, 0x41, 0x70, 0x5c, 0x43
, 0x40, 0x70, 0x4c, 0x43, 0x60, 0x30, 0x70, 0x4c, 0x42, 0x40, 0x60, 0x48, 0x30, 0x5f, 0x71, 0x7c
, 0x5f, 0x47, 0x70, 0x7c, 0x4f, 0x41, 0x70, 0x5c, 0x47, 0x41, 0x70, 0x30, 0x7f, 0x4f, 0x73, 0x78
, 0x7e, 0x4f, 0x63, 0x70, 0x7c, 0x4f, 0x43, 0x60, 0x78, 0x30, 0x40, 0x70, 0x4c, 0x43, 0x40, 0x50
, 0x4c, 0x41, 0x40, 0x50, 0x44, 0x41, 0x40, 0x50, 0x30, 0x78, 0x4e, 0x43, 0x60, 0x78, 0x4c, 0x43
, 0x40, 0x70, 0x4c, 0x43, 0x40, 0x70, 0x30, 0x40, 0x50, 0x44, 0x41, 0x40, 0x50, 0x44, 0x41, 0x40
, 0x50, 0x44, 0x41, 0x40, 0x70, 0x30, 0x70, 0x4c, 0x43, 0x40, 0x70, 0x4c, 0x43, 0x60, 0x78, 0x4e
, 0x43, 0x60, 0x78, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x40, 0x50, 0x44, 0x50, 0x64
, 0x4b, 0x60, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x48, 0x46, 0x41
, 0x70, 0x30, 0x40, 0x70, 0x4c, 0x43, 0x40, 0x70, 0x4c, 0x47, 0x41, 0x70, 0x5c, 0x47, 0x43, 0x70
, 0x30, 0x7c, 0x4f, 0x43, 0x78, 0x7e, 0x4f, 0x73, 0x7c, 0x7f, 0x4f, 0x7b, 0x7e, 0x7f, 0x70, 0x30
, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x74, 0x5f, 0x57, 0x70, 0x6c, 0x30, 0x4f, 0x67, 0x79, 0x7c
, 0x7f, 0x4f, 0x73, 0x7e, 0x7f, 0x7f, 0x7d, 0x7f, 0x43, 0x70, 0x30, 0x43, 0x70, 0x7c, 0x5f, 0x4f
, 0x73, 0x7d, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x45, 0x49, 0x73, 0x7e, 0x6f, 0x7b
, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x42, 0x6d, 0x7f, 0x5f, 0x77, 0x7f, 0x7f
, 0x7c, 0x7e, 0x4f, 0x43, 0x70, 0x7c, 0x30, 0x5f, 0x7f, 0x7b, 0x7c, 0x7c, 0x44, 0x30, 0x40, 0x40
, 0x40, 0x40, 0x40, 0x40, 0x63, 0x7e, 0x7f, 0x7f, 0x77, 0x74, 0x78, 0x30, 0x43, 0x70, 0x7c, 0x4f
, 0x47, 0x71, 0x7c, 0x5f, 0x4f, 0x73, 0x7c, 0x7f, 0x5f, 0x70, 0x30, 0x40, 0x48, 0x43, 0x40, 0x70
, 0x4e, 0x43, 0x60, 0x7c, 0x4f, 0x63, 0x78, 0x7f, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x73
, 0x7f, 0x7f, 0x7d, 0x7c, 0x69, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x43, 0x40, 0x7c, 0x4e
, 0x70, 0x45, 0x30, 0x40, 0x70, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x60, 0x6a
, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x5f, 0x73, 0x7c, 0x4f, 0x41, 0x70, 0x5c, 0x43, 0x40, 0x70, 0x30
, 0x7c, 0x4e, 0x43, 0x60, 0x78, 0x4c, 0x42, 0x40, 0x60, 0x48, 0x43, 0x40, 0x60, 0x30, 0x5b, 0x66
, 0x42, 0x30, 0x45, 0x40, 0x58, 0x41, 0x40, 0x50, 0x40, 0x40, 0x48, 0x53, 0x61, 0x7f, 0x7f, 0x50
, 0x30, 0x40, 0x50, 0x44, 0x41, 0x60, 0x4e, 0x6d, 0x7e, 0x5e, 0x7b, 0x7d, 0x7f, 0x5f, 0x70, 0x30
, 0x70, 0x4c, 0x43, 0x60, 0x78, 0x5d, 0x47, 0x71, 0x7d, 0x5f, 0x4f, 0x7f, 0x7e, 0x70, 0x30, 0x40
, 0x44, 0x42, 0x40, 0x70, 0x58, 0x5f, 0x45, 0x72, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x40, 0x44
, 0x43, 0x60, 0x7c, 0x4f, 0x72, 0x6c, 0x70, 0x6f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x40, 0x40, 0x60
, 0x5c, 0x4e, 0x46, 0x40, 0x40, 0x40, 0x4d, 0x43, 0x79, 0x7f, 0x70, 0x30, 0x40, 0x40, 0x44, 0x47
, 0x43, 0x71, 0x7c, 0x7f, 0x4f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x40, 0x40, 0x41, 0x40, 0x68
, 0x48, 0x43, 0x50, 0x70, 0x4a, 0x43, 0x50, 0x78, 0x30, 0x40, 0x50, 0x44, 0x43, 0x40, 0x70, 0x5c
, 0x47, 0x41, 0x70, 0x7c, 0x4f, 0x47, 0x70, 0x30, 0x40, 0x40, 0x40, 0x74, 0x5f, 0x77, 0x7f, 0x7f
, 0x4f, 0x7f, 0x7d, 0x7f, 0x5f, 0x70, 0x30, 0x41, 0x70, 0x4c, 0x40, 0x40, 0x4c, 0x43, 0x74, 0x7e
, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x78, 0x5f, 0x48, 0x6f, 0x49, 0x7b, 0x7e, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x78, 0x4c, 0x43, 0x60, 0x70, 0x4c, 0x43, 0x60, 0x70, 0x4c, 0x43
, 0x60, 0x68, 0x30, 0x40, 0x40, 0x48, 0x43, 0x40, 0x50, 0x46, 0x41, 0x70, 0x5e, 0x43, 0x70, 0x74
, 0x30, 0x6f, 0x77, 0x7c, 0x7f, 0x47, 0x79, 0x7e, 0x5f, 0x43, 0x7d, 0x7f, 0x47, 0x5a, 0x70, 0x30
, 0x7e, 0x5f, 0x53, 0x71, 0x7e, 0x4f, 0x53, 0x7c, 0x7e, 0x4f, 0x73, 0x7a, 0x7f, 0x30, 0x7f, 0x7f
, 0x7d, 0x7f, 0x57, 0x70, 0x7c, 0x47, 0x40, 0x72, 0x4c, 0x51, 0x54, 0x70, 0x30, 0x40, 0x40, 0x40
, 0x40, 0x40, 0x50, 0x44, 0x41, 0x40, 0x78, 0x5c, 0x4f, 0x7f, 0x70, 0x30, 0x7c, 0x4f, 0x63, 0x78
, 0x7e, 0x4f, 0x73, 0x7a, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x59, 0x56, 0x44, 0x72, 0x4c
, 0x43, 0x60, 0x58, 0x47, 0x41, 0x79, 0x5e, 0x63, 0x60, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x77
, 0x7f, 0x7f, 0x47, 0x72, 0x7c, 0x57, 0x49, 0x50, 0x30, 0x7f, 0x6f, 0x7f, 0x7e, 0x7c, 0x7f, 0x63
, 0x70, 0x7e, 0x4f, 0x63, 0x78, 0x7f, 0x60, 0x30, 0x4f, 0x73, 0x7e, 0x57, 0x41, 0x70, 0x54, 0x30
, 0x7f, 0x6f, 0x63, 0x70, 0x7a, 0x4a, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x70, 0x30, 0x42
, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x4c, 0x47, 0x55, 0x70, 0x30, 0x7f, 0x4f
, 0x73, 0x78, 0x7e, 0x4e, 0x63, 0x60, 0x70, 0x4c, 0x41, 0x60, 0x60, 0x30, 0x41, 0x70, 0x4b, 0x43
, 0x70, 0x4d, 0x43, 0x62, 0x78, 0x4f, 0x43, 0x68, 0x7c, 0x30, 0x7f, 0x7f, 0x7e, 0x7f, 0x7f, 0x7f
, 0x7c, 0x7f, 0x5f, 0x71, 0x7c, 0x5f, 0x45, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x77, 0x7f, 0x7f, 0x73, 0x62, 0x71, 0x50, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7c, 0x60
, 0x6d, 0x65, 0x6e, 0x5c, 0x6b, 0x70, 0x30, 0x7d, 0x7e, 0x5b, 0x7b, 0x75, 0x5b, 0x50, 0x42, 0x40
, 0x40, 0x43, 0x40, 0x74, 0x30, 0x7f, 0x7f, 0x7d, 0x7f, 0x5d, 0x7a, 0x6e, 0x44, 0x48, 0x60, 0x40
, 0x40, 0x40, 0x50, 0x30, 0x7f, 0x4f, 0x7f, 0x7a, 0x7e, 0x4d, 0x42, 0x50, 0x50, 0x30, 0x7f, 0x4f
, 0x43, 0x74, 0x7d, 0x5f, 0x73, 0x7d, 0x7f, 0x6f, 0x7b, 0x7f, 0x7f, 0x70, 0x30, 0x43, 0x70, 0x6c
, 0x47, 0x40, 0x50, 0x44, 0x41, 0x40, 0x48, 0x41, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x75, 0x7f
, 0x76, 0x52, 0x64, 0x4c, 0x68, 0x48, 0x30, 0x63, 0x58, 0x7c, 0x43, 0x40, 0x40, 0x40, 0x40, 0x40
, 0x40, 0x40, 0x5f, 0x5f, 0x70, 0x30, 0x7f, 0x6e, 0x68, 0x50, 0x40, 0x40, 0x40, 0x40, 0x40, 0x44
, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x44, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x6f, 0x7b
, 0x76, 0x7f, 0x60, 0x30, 0x41, 0x70, 0x5c, 0x47, 0x43, 0x70, 0x7c, 0x5f, 0x47, 0x71, 0x7c, 0x5f
, 0x47, 0x70, 0x30, 0x70, 0x4e, 0x43, 0x70, 0x7c, 0x4f, 0x63, 0x7a, 0x7f, 0x4f, 0x7b, 0x7f, 0x7f
, 0x70, 0x30, 0x5f, 0x75, 0x7c, 0x7f, 0x41, 0x70, 0x30, 0x47, 0x71, 0x7c, 0x4f, 0x43, 0x70, 0x7c
, 0x4f, 0x43, 0x70, 0x7c, 0x4f, 0x41, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x79, 0x7e, 0x4f, 0x73, 0x7c
, 0x7e, 0x4f, 0x73, 0x7c, 0x7f, 0x30, 0x40, 0x40, 0x43, 0x40, 0x70, 0x46, 0x40, 0x50, 0x42, 0x30
, 0x40, 0x40, 0x40, 0x43, 0x47, 0x71, 0x7d, 0x5f, 0x5f, 0x71, 0x7c, 0x6d, 0x41, 0x50, 0x30, 0x40
, 0x40, 0x40, 0x40, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x40, 0x40
, 0x5e, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7e, 0x6d, 0x30, 0x70, 0x4e, 0x42, 0x50
, 0x78, 0x4a, 0x43, 0x40, 0x50, 0x30, 0x40, 0x50, 0x56, 0x40, 0x40, 0x70, 0x40, 0x45, 0x40, 0x50
, 0x40, 0x41, 0x42, 0x50, 0x30, 0x40, 0x40, 0x42, 0x40, 0x5c, 0x4b, 0x41, 0x5c, 0x53, 0x6b, 0x7d
, 0x7f, 0x57, 0x70, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x50, 0x43
, 0x43, 0x60, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x41, 0x42, 0x40, 0x4a, 0x68, 0x42, 0x52, 0x1f
, 0x5a, 0x5a, 0x1f, 0x23, 0x20, 0x20, 0x20, 0x43, 0x49, 0x1f, 0x23, 0x21, 0x30, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7d, 0x7f, 0x4f, 0x71, 0x74, 0x58, 0x30, 0x7f, 0x6f, 0x7b, 0x7c, 0x7f, 0x4f
, 0x7b, 0x78, 0x7e, 0x5f, 0x63, 0x70, 0x7a, 0x30, 0x40, 0x40, 0x48, 0x41, 0x44, 0x40, 0x40, 0x54
, 0x42, 0x70, 0x44, 0x40, 0x44, 0x50, 0x30, 0x6f, 0x72, 0x7e, 0x5d, 0x4b, 0x72, 0x6e, 0x47, 0x44
, 0x64, 0x74, 0x74, 0x43, 0x50, 0x30, 0x68, 0x49, 0x62, 0x64, 0x61, 0x56, 0x60, 0x69, 0x41, 0x5b
, 0x6a, 0x6b, 0x6c, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7e, 0x65, 0x54, 0x60
, 0x41, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x60, 0x42, 0x40, 0x41, 0x45, 0x50
, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x54, 0x79, 0x77, 0x6f, 0x50, 0x30
, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x58, 0x5a, 0x56, 0x7f, 0x72, 0x64, 0x6f, 0x70, 0x30, 0x4b
, 0x53, 0x40, 0x75, 0x6b, 0x6b, 0x56, 0x5e, 0x5a, 0x7a, 0x7b, 0x7f, 0x5f, 0x70, 0x30, 0x44, 0x48
, 0x52, 0x60, 0x69, 0x41, 0x53, 0x50, 0x75, 0x4f, 0x5d, 0x5e, 0x7f, 0x70, 0x30, 0x40, 0x40, 0x42
, 0x40, 0x50, 0x41, 0x46, 0x44, 0x50, 0x70, 0x6e, 0x69, 0x7f, 0x70, 0x30, 0x40, 0x40, 0x40, 0x40
, 0x40, 0x78, 0x5c, 0x67, 0x77, 0x7f, 0x7d, 0x5f, 0x7f, 0x70, 0x30, 0x41, 0x70, 0x4c, 0x40, 0x70
, 0x4f, 0x43, 0x78, 0x7f, 0x6f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7e, 0x7e, 0x48
, 0x30, 0x7c, 0x46, 0x43, 0x70, 0x70, 0x4d, 0x48, 0x42, 0x51, 0x50, 0x6c, 0x65, 0x62, 0x70, 0x30
, 0x69, 0x40, 0x42, 0x54, 0x50, 0x68, 0x62, 0x69, 0x62, 0x4d, 0x63, 0x5b, 0x7f, 0x70, 0x30, 0x69
, 0x51, 0x56, 0x6d, 0x51, 0x70, 0x44, 0x67, 0x64, 0x76, 0x69, 0x5f, 0x5a, 0x70, 0x30, 0x6d, 0x5d
, 0x5b, 0x55, 0x5f, 0x79, 0x7d, 0x6f, 0x6f, 0x7f, 0x7f, 0x5f, 0x7f, 0x70, 0x30, 0x40, 0x4d, 0x52
, 0x76, 0x76, 0x7b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x51, 0x57, 0x53, 0x5f
, 0x5e, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x52, 0x7b, 0x7e, 0x6f, 0x6f
, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40
, 0x70, 0x6c, 0x4f, 0x47, 0x71, 0x7c, 0x5f, 0x47, 0x70, 0x30, 0x60, 0x5a, 0x7f, 0x7b, 0x7f, 0x7e
, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7e, 0x6f, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x5f, 0x42, 0x70, 0x30, 0x60, 0x48, 0x42, 0x40, 0x60, 0x48, 0x42, 0x40, 0x70, 0x48, 0x43
, 0x40, 0x70, 0x30, 0x47, 0x71, 0x7c, 0x5f, 0x47, 0x71, 0x7c, 0x4f, 0x41, 0x70, 0x30, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x75, 0x7f, 0x7e, 0x54, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7e, 0x7c, 0x58, 0x5c, 0x5f, 0x47, 0x70, 0x30, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x58, 0x42
, 0x41, 0x77, 0x5f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x7e, 0x4e, 0x5f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x50, 0x4f, 0x6b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x7f, 0x70, 0x30, 0x40, 0x7b, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f
, 0x7f, 0x7f, 0x7f, 0x70, 0x1f, 0x5a, 0x5a



, 0x0f, 0x1f, 0x44, 0x54, 0x42, 0x69, 0x65, 0x6e, 0x76, 0x65, 0x6e, 0x75, 0x65, 0x20, 0x64, 0x61
, 0x6e, 0x73, 0x20, 0x1f, 0x45, 0x54, 0x6c, 0x65, 0x73, 0x20, 0x61, 0x6e, 0x6e, 0x19, 0x42, 0x65
, 0x65, 0x73, 0x20, 0x38, 0x30, 0x73, 0x1f, 0x4e, 0x55, 0x1b, 0x4e, 0x43, 0x27, 0x19, 0x42, 0x65
, 0x74, 0x61, 0x69, 0x74, 0x1f, 0x50, 0x57, 0x1b, 0x4f, 0x6d, 0x69, 0x65, 0x75, 0x78, 0x1f, 0x52
, 0x59, 0x1b, 0x48, 0x1b, 0x4e, 0x61, 0x76, 0x61, 0x6e, 0x74
    };
    
    [self sendBytesToMinitel:str length:sizeof(str)];
}
- (IBAction) test3:(id)sender
{
#if 0
    NSString *s = @"%0C%1FAA%0E%1B%40%1BT%20%12EX%1BA%1BP%1BZ%20%1BG%40%5E_%12IT%1B%40%1BW%1BYT0%20%12E%1BQ%12K%1FBA%0E%1B%40%1BT%20%12C%40%5E%1BA%1BP%1BZ%20%1BG%40%5E_%12LT%1B%40%1BW%1BYT%20%12D%1BQ%12K%1FCA%0E%1B%40%1BT%20%12BH%1BA%1BP%1BZ%20%12B%1BG_%12OT%1B%40%1BW%1BYT%20%12C%1BQ%12K%1FDA%0E%1B%40%1BT%20%12B%1BA%1BP%1BZ%12B%1BG%40X_%12P0%1B%40%1BW%1BY4%20%12B%1BQ%12K%1FEA%0E%1B%40%1BT%20%20%1BA%1BP%1BZ%12B%1BGH%25%5B_%12PU%09%1B%40%1BW%1BY%20%12B%1BQ%12K%1FFA%0E%1B%40%1BT%20%20%1BA%1BP%1BZ%12C%1BG%24_%12R%09%1B%40%1BW%1BY5%20%20%1BQ%12K%1FGA%0E%1B%40%1BT%20%20%1BA%1BP%1BZ%12C%1BG(_%12R5%1B%40%1BW%1BY5%20%20%1BQ%12K%1FHA%0E%1B%40%1BT%20%20%1BA%1BP%1BZ%12D%1BG_%12R5%1B%40%1BW%1BY5%20%20%1BQ%12K%1FIA%0E%1B%40%1BT%20%20%1BA%1BP%1BZ%12D%1BG_%12D%3F%27%23%12B%2B_%12B%3F%2F%23%12B!%1B%40%1BW%1BY%5D%20%20%1BQ%12K%1FJA%0E%1B%40%1BT%20%20%1BA%1BP%1BZ%12D%1BG_%12C%27%40P%1BA%20%20%1BG%5C0J_%5D%40P%09%09%5C%09%09%1B%40%1BW%1BY%20%20%1BQ%12K%1FKA%0E%1B%40%1BT%20%20%1BG%1BP%1BZH%1BA%20%1BG%406%5B_%12B8%27%40%1BA%20%1BG%40P4%22__VXPPRXU%1B%40%1BW%1BY5%20%1BQ%12K%1FLA%0E%1B%40%1BT%20%20%1BG%1BP%1BZJ42_%12J%5D%5D_%12H%1B%40%1BW%1BY5%20%1BQ%12K%1FMA%0E%1B%40%1BT%20%12B%1BG%1BP%1BZ_7_%12T%3D%1B%40%1BW%1BY5%20%1BQ%12K%1FNA%0E%1B%40%1BT%20%12B%1BG%1BP%1BZJ%5DZ_O_%12QU%1B%40%1BW%1BY%20%20%1BQ%12K%1FOA%0E%1B%40%1BT%20%12C%1BG%1BP%1BZ_V7C_%12GK_%12C%3F_%12C5%1B%40%1BW%1BY%20%20%1BQ%12K%1FPA%0E%1B%40%1BT%20%12C%1BG%1BP%1BZJ_%12JVQ0%1BA%20%20%1BG%40%5E_%12B5%1B%40%1BW%1BY%20%20%1BQ%12K%1FQA%0E%1B%40%1BT%20%12D%1BG%1BP%1BZO_%12GO_%12CU%5C_%12D5%1B%40%1BW%1BY%20%20%1BQ%12K%1FRA%0E%1B%40%1BT%20%12E%1BG%1BP%1BZ%22_%12EE_%12K%1B%40%1BW%1BY5%20%20%1BQ%12K%1FSA%0E%1B%40%1BT%20%12F%1BG%1BP%1BZ*_%12F7%27%23%1BA%20%12C%1BG!%22__%1B%40%1BW%1BY5%20%20%1BQ%12K%1FTA%0E%1B%40%1BT%20%12F%1BG%1BP%1BZOO_%12DE%5CS%2F%2C%2C-%2FX%5E_7%1B%40%1BW%1BY%25%20%20%1BQ%12K%1FUA%0E%1B%40%1BT%20%12C%40%5E%1BQ_%1BW!K%1BG%1BP%1BZK_%12GPPX%5E__%27%25%1B%40%1BW%1BY%20%12B%1BQ%12K%1FVA%0E%1B%40%1BT%20%20P%5C%1BQ_%12B%1BW%20%20%2B%1BG%1BP%1BZ_%12BW%5B_%12I%1B%40%1BW%1BYT%20%12B%1BQ%12K%1FWA%0E%1B%40%1BQ_%12F%1BW%20%12B%2B%1BG%1BP%1BZ%3F%2F%27_%12H7!%09%09%1B%40%1BW%1BY%5CP%1BQ%20%12J%1FXA%0E%1B%40%1BQ_%12F%1BW%20%12C%2B%09%09%1BG%1BP%1BZ%22%2B%2F%12E%27%09%09%09%09%09%09%09%1B%40%1BQ%1BY%5CP%20%12G%1FF%5E%0E%1BP%1BA_%0B%08_%1FE_%0E%1BP%20%12F%1FF_%0E%1BP%20%12F%1FF_%1BO%1BH51%2C%1FFd%1BO%1BH7";
    s = [s  stringByRemovingPercentEncoding];
    [self sendStringToMinitel:s];
#endif
    // cat ... | od -v -t x1  | sed 's/^[0-9]* //g' | sed 's/   /  /g'  | sed 's/  /, 0x/g'  > /tmp/t

    uint8_t mitterand[] = {
  0x0c, 0x1f, 0x41, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x45
, 0x1b, 0x40, 0x58, 0x1b, 0x50, 0x1b, 0x47, 0x20, 0x1b, 0x5a, 0x40, 0x5e, 0x5f, 0x12, 0x49, 0x54
, 0x1b, 0x57, 0x1b, 0x40, 0x1b, 0x59, 0x54, 0x30, 0x1b, 0x47, 0x20, 0x12, 0x45, 0x1b, 0x51, 0x12
, 0x4b, 0x1f, 0x42, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x43
, 0x1b, 0x40, 0x40, 0x1b, 0x50, 0x1b, 0x44, 0x21, 0x1b, 0x47, 0x20, 0x1b, 0x5a, 0x40, 0x5e, 0x5f
, 0x12, 0x4c, 0x54, 0x1b, 0x57, 0x1b, 0x40, 0x1b, 0x59, 0x54, 0x1b, 0x47, 0x20, 0x12, 0x44, 0x1b
, 0x51, 0x12, 0x4b, 0x1f, 0x43, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20
, 0x12, 0x42, 0x1b, 0x40, 0x48, 0x1b, 0x50, 0x1b, 0x47, 0x20, 0x12, 0x42, 0x1b, 0x5a, 0x5f, 0x12
, 0x4f, 0x54, 0x1b, 0x57, 0x1b, 0x40, 0x1b, 0x59, 0x54, 0x1b, 0x47, 0x20, 0x12, 0x43, 0x1b, 0x51
, 0x12, 0x4b, 0x1f, 0x44, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12
, 0x42, 0x1b, 0x50, 0x12, 0x42, 0x1b, 0x5a, 0x40, 0x58, 0x5f, 0x12, 0x50, 0x30, 0x1b, 0x57, 0x1b
, 0x40, 0x1b, 0x59, 0x34, 0x1b, 0x47, 0x20, 0x12, 0x42, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x45, 0x41
, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x12, 0x42, 0x1b
, 0x5a, 0x48, 0x25, 0x5b, 0x5f, 0x12, 0x50, 0x55, 0x1b, 0x59, 0x20, 0x1b, 0x57, 0x12, 0x43, 0x1b
, 0x51, 0x12, 0x4b, 0x1f, 0x46, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20
, 0x20, 0x1b, 0x50, 0x12, 0x43, 0x1b, 0x5a, 0x24, 0x5f, 0x12, 0x52, 0x1b, 0x59, 0x20, 0x4a, 0x1b
, 0x57, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x47, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b
, 0x59, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x12, 0x43, 0x1b, 0x5a, 0x28, 0x5f, 0x12, 0x52, 0x35
, 0x1b, 0x59, 0x4a, 0x1b, 0x57, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x48, 0x41, 0x0e, 0x1b
, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x12, 0x44, 0x1b, 0x5a, 0x5f
, 0x12, 0x52, 0x35, 0x1b, 0x59, 0x4a, 0x1b, 0x57, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x49
, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x12, 0x44
, 0x1b, 0x5a, 0x5f, 0x12, 0x44, 0x3f, 0x27, 0x23, 0x12, 0x42, 0x2b, 0x5f, 0x12, 0x42, 0x3f, 0x2f
, 0x23, 0x12, 0x42, 0x21, 0x1b, 0x59, 0x22, 0x1b, 0x57, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f
, 0x4a, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x12
, 0x44, 0x1b, 0x5a, 0x5f, 0x12, 0x43, 0x27, 0x40, 0x50, 0x1b, 0x59, 0x20, 0x20, 0x1b, 0x5a, 0x5c
, 0x30, 0x4a, 0x5f, 0x5d, 0x40, 0x50, 0x1b, 0x59, 0x20, 0x20, 0x1b, 0x5a, 0x5c, 0x1b, 0x59, 0x20
, 0x20, 0x1b, 0x57, 0x12, 0x42, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x4b, 0x41, 0x0e, 0x1b, 0x54, 0x1b
, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x1b, 0x5a, 0x48, 0x1b, 0x59, 0x20, 0x1b
, 0x5a, 0x40, 0x36, 0x5b, 0x5f, 0x12, 0x42, 0x38, 0x27, 0x40, 0x1b, 0x59, 0x20, 0x1b, 0x5a, 0x40
, 0x50, 0x34, 0x22, 0x5f, 0x5f, 0x56, 0x58, 0x50, 0x50, 0x52, 0x58, 0x55, 0x1b, 0x59, 0x4a, 0x1b
, 0x57, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x4c, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59
, 0x1b, 0x49, 0x20, 0x20, 0x1b, 0x50, 0x1b, 0x5a, 0x4a, 0x34, 0x32, 0x5f, 0x12, 0x4a, 0x5d, 0x5d
, 0x5f, 0x12, 0x48, 0x1b, 0x59, 0x4a, 0x1b, 0x57, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x4d, 0x41
, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x42, 0x1b, 0x50, 0x1b, 0x5a
, 0x5f, 0x37, 0x5f, 0x12, 0x54, 0x3d, 0x1b, 0x59, 0x4a, 0x1b, 0x57, 0x20, 0x1b, 0x51, 0x12, 0x4b
, 0x1f, 0x4e, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x42, 0x1b
, 0x50, 0x1b, 0x5a, 0x4a, 0x5d, 0x5a, 0x5f, 0x4f, 0x5f, 0x12, 0x51, 0x55, 0x1b, 0x57, 0x1b, 0x59
, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x4f, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59
, 0x1b, 0x49, 0x20, 0x12, 0x43, 0x1b, 0x50, 0x1b, 0x5a, 0x5f, 0x56, 0x37, 0x43, 0x5f, 0x12, 0x47
, 0x4b, 0x5f, 0x12, 0x43, 0x3f, 0x5f, 0x12, 0x43, 0x35, 0x1b, 0x57, 0x1b, 0x59, 0x20, 0x20, 0x1b
, 0x51, 0x12, 0x4b, 0x1f, 0x50, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20
, 0x12, 0x43, 0x1b, 0x50, 0x1b, 0x5a, 0x4a, 0x5f, 0x12, 0x4a, 0x56, 0x51, 0x30, 0x1b, 0x59, 0x20
, 0x20, 0x1b, 0x5a, 0x40, 0x5e, 0x5f, 0x12, 0x42, 0x35, 0x1b, 0x57, 0x1b, 0x59, 0x20, 0x20, 0x1b
, 0x51, 0x12, 0x4b, 0x1f, 0x51, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20
, 0x12, 0x44, 0x1b, 0x50, 0x1b, 0x5a, 0x4f, 0x5f, 0x12, 0x47, 0x4f, 0x5f, 0x12, 0x43, 0x55, 0x5c
, 0x5f, 0x12, 0x44, 0x35, 0x1b, 0x57, 0x1b, 0x59, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x52
, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x45, 0x1b, 0x50, 0x1b
, 0x5a, 0x22, 0x5f, 0x12, 0x45, 0x45, 0x5f, 0x12, 0x4b, 0x1b, 0x59, 0x4a, 0x1b, 0x57, 0x20, 0x20
, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x53, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49
, 0x20, 0x12, 0x46, 0x1b, 0x50, 0x1b, 0x5a, 0x2a, 0x5f, 0x12, 0x46, 0x37, 0x27, 0x23, 0x1b, 0x59
, 0x20, 0x12, 0x43, 0x1b, 0x5a, 0x21, 0x22, 0x5f, 0x5f, 0x1b, 0x59, 0x4a, 0x1b, 0x57, 0x20, 0x20
, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x54, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49
, 0x20, 0x12, 0x46, 0x1b, 0x50, 0x1b, 0x5a, 0x4f, 0x4f, 0x5f, 0x12, 0x44, 0x45, 0x5c, 0x53, 0x2f
, 0x2c, 0x2c, 0x2d, 0x2f, 0x58, 0x5e, 0x5f, 0x37, 0x1b, 0x57, 0x1b, 0x40, 0x1b, 0x59, 0x25, 0x1b
, 0x47, 0x20, 0x20, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x55, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b
, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x43, 0x1b, 0x40, 0x40, 0x1b, 0x50, 0x1b, 0x44, 0x21, 0x1b, 0x47
, 0x20, 0x1b, 0x57, 0x1b, 0x40, 0x21, 0x1b, 0x50, 0x1b, 0x47, 0x34, 0x1b, 0x5a, 0x4b, 0x5f, 0x12
, 0x47, 0x50, 0x50, 0x58, 0x5e, 0x5f, 0x5f, 0x27, 0x25, 0x1b, 0x57, 0x1b, 0x59, 0x20, 0x12, 0x42
, 0x1b, 0x51, 0x12, 0x4b, 0x1f, 0x56, 0x41, 0x0e, 0x1b, 0x54, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49
, 0x20, 0x20, 0x1b, 0x40, 0x50, 0x1b, 0x50, 0x1b, 0x44, 0x23, 0x1b, 0x47, 0x20, 0x12, 0x42, 0x1b
, 0x57, 0x12, 0x42, 0x1b, 0x50, 0x54, 0x1b, 0x5a, 0x5f, 0x12, 0x42, 0x57, 0x5b, 0x5f, 0x12, 0x49
, 0x1b, 0x57, 0x1b, 0x40, 0x1b, 0x59, 0x54, 0x1b, 0x47, 0x20, 0x12, 0x42, 0x1b, 0x51, 0x12, 0x4b
, 0x1f, 0x57, 0x41, 0x0e, 0x1b, 0x50, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x46, 0x1b
, 0x57, 0x12, 0x43, 0x1b, 0x50, 0x54, 0x1b, 0x5a, 0x3f, 0x2f, 0x27, 0x5f, 0x12, 0x48, 0x37, 0x21
, 0x1b, 0x59, 0x20, 0x20, 0x23, 0x1b, 0x57, 0x1b, 0x40, 0x50, 0x1b, 0x51, 0x1b, 0x47, 0x20, 0x12
, 0x4a, 0x1f, 0x58, 0x41, 0x0e, 0x1b, 0x50, 0x1b, 0x47, 0x1b, 0x59, 0x1b, 0x49, 0x20, 0x12, 0x46
, 0x1b, 0x57, 0x12, 0x44, 0x1b, 0x50, 0x54, 0x20, 0x20, 0x1b, 0x5a, 0x22, 0x2b, 0x2f, 0x12, 0x45
, 0x27, 0x1b, 0x59, 0x20, 0x12, 0x46, 0x1b, 0x41, 0x23, 0x1b, 0x51, 0x1b, 0x40, 0x50, 0x1b, 0x47
, 0x20, 0x12, 0x47, 0x1f, 0x46, 0x5e, 0x0e, 0x1b, 0x50, 0x1b, 0x41, 0x5f, 0x0b, 0x08, 0x5f, 0x1f
, 0x45, 0x5f, 0x0e, 0x1b, 0x50, 0x20, 0x12, 0x46, 0x1f, 0x46, 0x5f, 0x0e, 0x1b, 0x50, 0x20, 0x12
, 0x46, 0x1f, 0x46, 0x5f, 0x1b, 0x4f, 0x1b, 0x48, 0x35, 0x31, 0x1b, 0x4d, 0x2c, 0x1b, 0x4f, 0x1b
, 0x48, 0x37
    };
    [self sendBytesToMinitel:mitterand length:sizeof(mitterand)];

}
- (IBAction) test4:(id)sender
{
    // PRO1 ESC 39
    // ! 29 ! PRO1 7B ({)        ! Lecture ROM (Identification du terminal).          !
    // ! 20 ! PRO1 72 (r)        ! Demande de status fonctionnement.                  !

    uint8_t cmd[] = { 0x1B, 0x39, 0x72};
    [self sendBytesToMinitel:cmd length:sizeof(cmd)];
}
@end
